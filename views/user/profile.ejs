<%- include('../components/header') %>
<section class="py-5">
  <div class="container">
    <div class="row">
      <div class="col-4">
        <img src="<%= profile.profileImg %>" alt="sorry it's problem showing this image" class="img-fluid rounded-circle">
      </div>
      <div class="col-8">
        <h1 class="text-center text-capitalize"><%= profile.firstName %> <%= profile.lastName %></h1>
        <div class="d-flex justify-content-center mt-3">
          <% if (user) { %>
            <% if (user._id != profile._id) { %>
              <% if (isFriend == true) { %>
                <a href="#" class="btn btn-primary me-3">delete friend</a>
                <a href="#" class="btn btn-primary d-inline-flex">
                  <span class="material-icons mx-2">chat</span> chat
                </a>
              <% } else if (isHasRequested == true) { %>
                <form action="/users/cancel/<%= profile._id %>" method="post">
                  <button type="submit" name="button" class="btn btn-primary d-inline-flex">
                    <span class="material-icons mx-2">person_off</span> cancel request
                  </button>
                </form>
              <% } else if (isRequestSent == true) { %>
                <a href="#" class="btn btn-primary me-3 d-inline-flex"><span class="material-icons me-1">done</span>confirm</a>
                <form action="/users/ignore/<%= profile._id %>" method="post">
                  <button type="submit" class="btn btn-primary d-inline-flex">
                    <span class="material-icons me-1">close</span>ignore
                  </button>
                </form>
              <% } else { %>
                <form action="/users/request/<%= profile._id %>" method="post">
                  <button type="submit" class="btn btn-primary d-inline-flex">
                    <span class="material-icons mx-2">person_add</span>add friend
                  </button>
                </form>
              <% } %>
            <% } %>
          <% } else { %>
            <a href="/users/login?next=/users/profile/<%= profile._id %>" class="btn btn-primary d-inline-flex">
              <span class="material-icons mx-2">person_add</span>add friend
            </a>
          <% } %>
        </div>
      </div>
    </div>
    <div class="row mt-3">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">Home</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Friends</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">User Info</button>
        </li>
      </ul>
      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade py-3 show active" id="home" role="tabpanel" aria-labelledby="home-tab">Home</div>
        <div class="tab-pane fade py-3" id="profile" role="tabpanel" aria-labelledby="profile-tab">
          <div class="d-flex align-items-start">
            <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
              <% if (user && user._id == profile._id) { %>
                <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home" aria-selected="true">Friends</button>
                <button class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" data-bs-target="#v-pills-profile" type="button" role="tab" aria-controls="v-pills-profile" aria-selected="false">Friend Requests</button>
                <button class="nav-link" id="v-pills-messages-tab" data-bs-toggle="pill" data-bs-target="#v-pills-messages" type="button" role="tab" aria-controls="v-pills-messages" aria-selected="false">Requests Sent</button>
              <% } %>
            </div>
            <div class="tab-content" id="v-pills-tabContent">
              <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                <% for(var i=0; i<profile.friends.length; i++) {%>
                   <div class="row mb-3">
                     <div class="d-flex justify-content-between">
                       <a href="/users/profile/<%= profile.friends[i].id %>" class="d-flex align-items-center me-5">
                         <img
                           src="<%= profile.friends[i].image %>"
                           alt="oops! it's problem showing your photo"
                           style="max-width:50px"
                           class="rounded-circle mx-3"
                         >
                         <h5><%= profile.friends[i].firstName %> <%= profile.friends[i].lastName %></h5>
                       </a>
                       <div class="buttons">
                         <a href="#" class="btn btn-primary">delete</a>
                         <a href="#" class="btn btn-primary">chat</a>
                       </div>
                     </div>
                   </div>
                   <hr>
                <% } %>
              </div>
              <% if (user && user._id == profile._id) { %>
                <!-- FRIEND REQUESTS -->
                <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                  <% for(var i=0; i<profile.friendRequests.length; i++) {%>
                     <div class="row mb-3">
                       <div class="d-flex justify-content-between">
                         <a href="/users/profile/<%= profile.friendRequests[i].id %>" class="d-flex align-items-center me-5">
                           <img
                             src="<%= profile.friendRequests[i].image %>"
                             alt="oops! it's problem showing your photo"
                             style="max-width:50px"
                             class="rounded-circle mx-3"
                           >
                           <h5><%= profile.friendRequests[i].firstName %> <%= profile.friendRequests[i].lastName %></h5>
                         </a>
                         <div class="buttons">
                           <a href="#" class="btn btn-primary">accept</a>
                           <a href="#" class="btn btn-primary">ignore</a>
                         </div>
                       </div>
                     </div>
                     <hr>
                  <% } %>
                </div>
                <!-- REQUESTS SENT -->
                <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                  <% for(var i=0; i<profile.sentRequests.length; i++) {%>
                     <div class="row mb-3">
                       <div class="d-flex justify-content-between">
                         <a href="/users/profile/<%= profile.sentRequests[i].id %>" class="d-flex align-items-center me-5">
                           <img
                             src="<%= profile.sentRequests[i].image %>"
                             alt="oops! it's problem showing your photo"
                             style="max-width:50px"
                             class="rounded-circle mx-3"
                           >
                           <h5><%= profile.sentRequests[i].firstName %> <%= profile.sentRequests[i].lastName %></h5>
                         </a>
                         <div class="buttons">
                           <a href="#" class="btn btn-primary">cancel request</a>
                         </div>
                       </div>
                     </div>
                     <hr>
                  <% } %>
                </div>
              <% } %>
            </div>
          </div>
        </div>
        <div class="tab-pane fade py-3" id="contact" role="tabpanel" aria-labelledby="contact-tab">User Info</div>
      </div>
    </div>
  </div>
</section>
<%- include('../components/footer') %>
